/*! Express.Admin 最后修改于：2016-03-19 */
!function(a){"use strict";String.prototype.replaceAll=function(a,b){return this.split(a).join(b)};var b=0,c=5,d=.5,e=function(b,c){return null===b||void 0===b||0===b.length||c&&""===a.trim(b)},f=function(a,b){a.removeClass(b).addClass(b)},g=function(a,b,c){var d=e(a.data(b))?a.attr(b):a.data(b);return d?d:c[b]},h=function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},i=function(a,b){return parseFloat(a.toFixed(b))},j=function(b,c){this.$element=a(b),this.init(c)};j.prototype={constructor:j,_parseAttr:function(a,f){var h=this,i=h.$element;if("range"===i.attr("type")||"number"===i.attr("type")){var j,k,l=g(i,a,f);switch(a){case"min":j=b;break;case"max":j=c;break;default:j=d}return k=e(l)?j:l,parseFloat(k)}return parseFloat(f[a])},setDefault:function(a,b){var c=this;e(c[a])&&(c[a]=b)},getPosition:function(a){return a.pageX-this.$rating.offset().left},listen:function(){var b,c,d=this;d.initTouch(),d.$rating.on("click",function(a){d.inactive||(b=d.getPosition(a),d.setStars(b),d.$element.trigger("change").trigger("rating.change",[d.$element.val(),d.$caption.html()]),d.starClicked=!0)}),d.$rating.on("mousemove",function(a){d.hoverEnabled&&!d.inactive&&(d.starClicked=!1,b=d.getPosition(a),c=d.calculate(b),d.toggleHover(c),d.$element.trigger("rating.hover",[c.val,c.caption,"stars"]))}),d.$rating.on("mouseleave",function(){!d.hoverEnabled||d.inactive||d.starClicked||(c=d.cache,d.toggleHover(c),d.$element.trigger("rating.hoverleave",["stars"]))}),d.$clear.on("mousemove",function(){if(d.hoverEnabled&&!d.inactive&&d.hoverOnClear){d.clearClicked=!1;var a='<span class="'+d.clearCaptionClass+'">'+d.clearCaption+"</span>",b=d.clearValue,e=d.getWidthFromValue(b);c={caption:a,width:e,val:b},d.toggleHover(c),d.$element.trigger("rating.hover",[b,a,"clear"])}}),d.$clear.on("mouseleave",function(){d.hoverEnabled&&!d.inactive&&!d.clearClicked&&d.hoverOnClear&&(c=d.cache,d.toggleHover(c),d.$element.trigger("rating.hoverleave",["clear"]))}),d.$clear.on("click",function(){d.inactive||(d.clear(),d.clearClicked=!0)}),a(d.$element[0].form).on("reset",function(){d.inactive||d.reset()})},destroy:function(){var b=this,c=b.$element;e(b.$container)||b.$container.before(c).remove(),a.removeData(c.get(0)),c.off("rating").removeClass("hide")},create:function(a){var b=this,c=b.$element;a=a||b.options||{},b.destroy(),c.rating(a)},setTouch:function(a,b){var c=this,d="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;if(d&&!c.inactive){var e=a.originalEvent,f=e.touches||e.changedTouches,g=c.getPosition(f[0]);if(b)c.setStars(g),c.$element.trigger("change").trigger("rating.change",[c.$element.val(),c.$caption.html()]),c.starClicked=!0;else{var h=c.calculate(g),i=h.val<=c.clearValue?c.fetchCaption(c.clearValue):h.caption,j=c.getWidthFromValue(c.clearValue),k=h.val<=c.clearValue?c.rtl?100-j+"%":j+"%":h.width;c.$caption.html(i),c.$stars.css("width",k)}}},initTouch:function(){var a=this;a.$rating.on("touchstart touchmove touchend",function(b){var c="touchend"===b.type;a.setTouch(b,c)})},initSlider:function(a){var f=this;e(f.$element.val())&&f.$element.val(0),f.initialValue=f.$element.val(),f.setDefault("min",f._parseAttr("min",a)),f.setDefault("max",f._parseAttr("max",a)),f.setDefault("step",f._parseAttr("step",a)),(isNaN(f.min)||e(f.min))&&(f.min=b),(isNaN(f.max)||e(f.max))&&(f.max=c),(isNaN(f.step)||e(f.step)||0===f.step)&&(f.step=d),f.diff=f.max-f.min},init:function(b){var c,d,g,h=this,i=h.$element;h.options=b,a.each(b,function(a,b){h[a]=b}),h.starClicked=!1,h.clearClicked=!1,h.initSlider(b),h.checkDisabled(),h.setDefault("rtl",i.attr("dir")),h.rtl&&i.attr("dir","rtl"),c=h.glyphicon?"":"★",h.setDefault("symbol",c),h.setDefault("clearButtonBaseClass","clear-rating"),h.setDefault("clearButtonActiveClass","clear-rating-active"),h.setDefault("clearValue",h.min),f(i,"form-control hide"),h.$clearElement=e(b.clearElement)?null:a(b.clearElement),h.$captionElement=e(b.captionElement)?null:a(b.captionElement),void 0===h.$rating&&void 0===h.$container&&(h.$rating=a(document.createElement("div")).html('<div class="rating-stars"></div>'),h.$container=a(document.createElement("div")),h.$container.before(h.$rating).append(h.$rating),i.before(h.$container).appendTo(h.$rating)),h.$stars=h.$rating.find(".rating-stars"),h.generateRating(),h.$clear=e(h.$clearElement)?h.$container.find("."+h.clearButtonBaseClass):h.$clearElement,h.$caption=e(h.$captionElement)?h.$container.find(".caption"):h.$captionElement,h.setStars(),h.listen(),h.showClear&&h.$clear.attr({"class":h.getClearClass()}),d=i.val(),g=h.getWidthFromValue(d),h.cache={caption:h.$caption.html(),width:(h.rtl?100-g:g)+"%",val:d},i.removeClass("rating-loading")},checkDisabled:function(){var a=this;a.disabled=g(a.$element,"disabled",a.options),a.readonly=g(a.$element,"readonly",a.options),a.inactive=a.disabled||a.readonly},getClearClass:function(){return this.clearButtonBaseClass+" "+(this.inactive?"":this.clearButtonActiveClass)},generateRating:function(){var a=this,b=a.renderClear(),c=a.renderCaption(),d=a.rtl?"rating-container-rtl":"rating-container",g=a.getStars();d+=a.glyphicon?(""===a.symbol?" rating-gly-star":" rating-gly")+a.ratingClass:e(a.ratingClass)?" rating-uni":" "+a.ratingClass,a.$rating.attr("class",d),a.$rating.attr("data-content",g),a.$stars.attr("data-content",g),d=a.rtl?"star-rating-rtl":"star-rating",a.$container.attr("class",d+" rating-"+a.size),a.$container.removeClass("rating-active rating-disabled"),a.inactive?a.$container.addClass("rating-disabled"):a.$container.addClass("rating-active"),void 0===a.$caption&&void 0===a.$clear&&(a.rtl?a.$container.prepend(c).append(b):a.$container.prepend(b).append(c)),e(a.containerClass)||f(a.$container,a.containerClass)},getStars:function(){var a,b=this,c=b.stars,d="";for(a=1;c>=a;a++)d+=b.symbol;return d},renderClear:function(){var a,b=this;return b.showClear?(a=b.getClearClass(),e(b.$clearElement)?'<div class="'+a+'" title="'+b.clearButtonTitle+'">'+b.clearButton+"</div>":(f(b.$clearElement,a),b.$clearElement.attr({title:b.clearButtonTitle}).html(b.clearButton),"")):""},renderCaption:function(){var a,b=this,c=b.$element.val();return b.showCaption?(a=b.fetchCaption(c),e(b.$captionElement)?'<div class="caption">'+a+"</div>":(f(b.$captionElement,"caption"),b.$captionElement.attr({title:b.clearCaption}).html(a),"")):""},fetchCaption:function(a){var b,c,d,f,g,h=this,i=parseFloat(a),j=h.starCaptions,k=h.starCaptionClasses;return f="function"==typeof k?k(i):k[i],d="function"==typeof j?j(i):j[i],c=e(d)?h.defaultCaption.replaceAll("{rating}",i):d,b=e(f)?h.clearCaptionClass:f,g=i===h.clearValue?h.clearCaption:c,'<span class="'+b+'">'+g+"</span>"},getWidthFromValue:function(a){var b=this,c=b.min,d=b.max;return c>=a||c===d?0:a>=d?100:100*(a-c)/(d-c)},getValueFromPosition:function(a){var b,c,d=this,e=h(d.step),f=d.$rating.width();return c=d.diff*a/(f*d.step),c=d.rtl?Math.floor(c):Math.ceil(c),b=i(parseFloat(d.min+c*d.step),e),b=Math.max(Math.min(b,d.max),d.min),d.rtl?d.max-b:b},toggleHover:function(a){var b,c,d,e=this;e.hoverChangeCaption&&(d=a.val<=e.clearValue?e.fetchCaption(e.clearValue):a.caption,e.$caption.html(d)),e.hoverChangeStars&&(b=e.getWidthFromValue(e.clearValue),c=a.val<=e.clearValue?e.rtl?100-b+"%":b+"%":a.width,e.$stars.css("width",c))},calculate:function(a){var b=this,c=e(b.$element.val())?0:b.$element.val(),d=arguments.length?b.getValueFromPosition(a):c,f=b.fetchCaption(d),g=b.getWidthFromValue(d);return b.rtl&&(g=100-g),g+="%",{caption:f,width:g,val:d}},setStars:function(a){var b=this,c=arguments.length?b.calculate(a):b.calculate();b.$element.val(c.val),b.$stars.css("width",c.width),b.$caption.html(c.caption),b.cache=c},clear:function(){var a=this,b='<span class="'+a.clearCaptionClass+'">'+a.clearCaption+"</span>";a.$stars.removeClass("rated"),a.inactive||a.$caption.html(b),a.$element.val(a.clearValue),a.setStars(),a.$element.trigger("rating.clear")},reset:function(){var a=this;a.$element.val(a.initialValue),a.setStars(),a.$element.trigger("rating.reset")},update:function(a){var b=this;arguments.length&&(b.$element.val(a),b.setStars())},refresh:function(b){var c=this;arguments.length&&(c.$rating.off("rating"),c.$clear.off(),c.init(a.extend(c.options,b)),c.showClear?c.$clear.show():c.$clear.hide(),c.showCaption?c.$caption.show():c.$caption.hide(),c.$element.trigger("rating.refresh"))}},a.fn.rating=function(b){var c=Array.apply(null,arguments);return c.shift(),this.each(function(){var d=a(this),e=d.data("rating"),f="object"==typeof b&&b;e||d.data("rating",e=new j(this,a.extend({},a.fn.rating.defaults,f,a(this).data()))),"string"==typeof b&&e[b].apply(e,c)})},a.fn.rating.defaults={stars:5,glyphicon:!0,symbol:null,ratingClass:"",disabled:!1,readonly:!1,rtl:!1,size:"md",showClear:!0,showCaption:!0,defaultCaption:"{rating} Stars",starCaptions:{.5:"Half Star",1:"One Star",1.5:"One & Half Star",2:"Two Stars",2.5:"Two & Half Stars",3:"Three Stars",3.5:"Three & Half Stars",4:"Four Stars",4.5:"Four & Half Stars",5:"Five Stars"},starCaptionClasses:{.5:"label label-danger",1:"label label-danger",1.5:"label label-warning",2:"label label-warning",2.5:"label label-info",3:"label label-info",3.5:"label label-primary",4:"label label-primary",4.5:"label label-success",5:"label label-success"},clearButton:'<i class="glyphicon glyphicon-minus-sign"></i>',clearButtonTitle:"Clear",clearButtonBaseClass:"clear-rating",clearButtonActiveClass:"clear-rating-active",clearCaption:"Not Rated",clearCaptionClass:"label label-default",clearValue:null,captionElement:null,clearElement:null,containerClass:null,hoverEnabled:!0,hoverChangeCaption:!0,hoverChangeStars:!0,hoverOnClear:!0},a.fn.rating.Constructor=j,a("input.rating").addClass("rating-loading"),a(document).ready(function(){var b=a("input.rating"),c=Object.keys(b).length;c>0&&b.rating()})}(window.jQuery);